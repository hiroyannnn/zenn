---
title: "gh-pr-inbox：PRレビューをLLMに渡しやすく整形するCLI"
emoji: "📬"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["github","cli","go","llm"]
published: false
---

## これは何か

`gh-pr-inbox` は、PRのレビューコメントを「未解決のみ・優先度付き」で抽出するGitHub CLI拡張です。主にLLM/AIエージェントにPRの修正指示を渡す前処理として使います。

<https://github.com/hiroyannnn/gh-pr-inbox>

## 背景

Claude CodeやCursor AgentなどにPRの修正を依頼する場面が増えています。ただ、GitHub APIから取得したレビューコメントをそのまま渡すと、以下の問題があります。

- 解決済みのスレッドも含まれる
- 優先度の区別がない
- 情報量が多くトークンを消費する
- どのファイルの何行目かが分かりにくい

`gh-pr-inbox` はこれらを整理し、LLMが処理しやすい形式に変換します。

## インストール

```bash
gh extension install hiroyannnn/gh-pr-inbox
```

短縮aliasを設定しておくと便利です。

```bash
gh alias set pri 'pr-inbox'
```

ソースからビルドする場合：

```bash
git clone https://github.com/hiroyannnn/gh-pr-inbox.git
cd gh-pr-inbox
go build -o gh-pr-inbox .
```

## 基本的な使い方

PRの作業ブランチで実行します。

```bash
gh pr-inbox
```

PR番号やリポジトリを指定することもできます。

```bash
gh pr-inbox 123
gh pr-inbox --repo owner/repo --pr 123
```

## 出力形式

デフォルトではMarkdown形式で出力されます。ファイルごとにグループ化され、優先度・行番号・コメント内容が整理された形式になります。

```markdown
# PR Inbox for owner/repo #123

[Fix authentication bug](https://github.com/owner/repo/pull/123)

> PRの目的や説明文（あれば）

Summary: P0 1 | P1 2 | P2 1

Hot files: src/auth.go (2), cmd/root.go (1)

## src/auth.go

- [P0] L45 by reviewer1 — This has a potential security vulnerability
  - Latest: We should sanitize user input here
  - Link: https://github.com/owner/repo/pull/123#discussion_r123456789

- [P1] L120 by reviewer2 — This logic seems complex, can we simplify?
  - Latest: Consider extracting this into a separate function
  - Link: https://github.com/owner/repo/pull/123#discussion_r123456790

## internal/util.go

- [P2] L30 by reviewer3 — nit: consider using a more descriptive variable name
  - Latest: Maybe rename 'x' to 'userCount'?
  - Link: https://github.com/owner/repo/pull/123#discussion_r123456791
```

未解決のスレッドのみが抽出され、優先度順（P0 → P1 → P2）にソートされています。

## 優先度の判定ロジック

コメント本文のキーワードに基づいて優先度を判定します。

| 優先度 | キーワード |
|--------|-----------|
| P0（高） | must, block, blocking, security, crash, bug, failure, incorrect |
| P2（低） | nit, nitpick, style, optional, suggest, tiny |
| P1（中） | 上記以外 |

また、スレッド内のコメント数が5件以上の場合は議論が長引いているとみなしてP1に昇格します。

レビュアーが `nit:` といったプレフィックスを使っていれば、自動的にP2が付きます。

## LLM/エージェントへの受け渡し

このツールの主な用途は、LLMやAIエージェントへの入力データ整形です。

### Markdown出力（デフォルト）

デフォルトのMarkdown形式は、LLMへの入力としてそのまま使えます。

```bash
gh pr-inbox | claude "このレビューコメントに対応するコード修正を行ってください"
```

### JSON出力

`--format json` でJSON形式で出力できます。構造化データとして扱いたい場合に便利です。

```bash
gh pr-inbox --format json
```

出力例：

```json
{
  "repo": "owner/repo",
  "number": 123,
  "title": "Fix authentication bug",
  "url": "https://github.com/owner/repo/pull/123",
  "goal": "PRの目的や説明文",
  "items": [
    {
      "threadId": "123456789",
      "priority": "P0",
      "filePath": "src/auth.go",
      "lineNumber": 45,
      "author": "reviewer1",
      "summary": "This has a potential security vulnerability",
      "latest": "We should sanitize user input here",
      "url": "https://github.com/owner/repo/pull/123#discussion_r123456789",
      "resolved": false
    }
  ]
}
```

jqと組み合わせて特定の優先度だけ抽出することもできます。

```bash
gh pr-inbox --format json | jq '.items[] | select(.priority == "P0")'
```

### プロンプトテンプレート

設定ファイルで `prompt` を定義すると、出力をテンプレートに埋め込めます。

```yaml
# ~/.config/gh/pr-inbox.yml
prompt: |
  以下はPRの未解決レビューコメントです。優先度順に対応してください。

  {{THREADS_MD}}
```

`{{THREADS_MD}}` はMarkdown形式のスレッド一覧に置換されます。`{{THREADS_JSON}}` でJSON形式も使えます。

その他のテンプレート変数：

| 変数 | 内容 |
|------|------|
| `{{REPO}}` | リポジトリ名（owner/repo） |
| `{{PR_NUMBER}}` | PR番号 |
| `{{PR_TITLE}}` | PRタイトル |
| `{{PR_URL}}` | PRのURL |
| `{{PR_GOAL}}` | PRの説明文 |
| `{{THREADS_MD}}` | Markdown形式のスレッド一覧 |
| `{{THREADS_JSON}}` | JSON形式のスレッド一覧 |

### Claude Codeでの使用例

```bash
gh pr-inbox | claude "このレビューコメントに対応するコード修正を行ってください"
```

プロンプトテンプレートを使う場合：

```bash
gh pr-inbox --prompt-file ~/.config/gh/pr-inbox-prompt.txt | claude
```

### 追加情報の付与

LLMに渡す情報量を増やしたい場合、以下のオプションが使えます。

| オプション | 説明 |
|-----------|------|
| `--include-diff` | 該当箇所の差分を含める |
| `--include-times` | コメントの日時情報を含める |
| `--all-comments` | スレッド内の全コメントを含める |
| `--include-issue-comments` | PRの会話コメントも含める |

```bash
gh pr-inbox --include-diff --all-comments
```

差分情報があると、LLMが修正箇所を特定しやすくなります。

なお、CodeRabbitなどのレビューボットはnitpick系の指摘をPR全体への会話コメント（Issue comments）として書くことがあります。これらも拾いたい場合は `--include-issue-comments` を有効にしてください。

```bash
gh pr-inbox --include-issue-comments
```

## 解決判定の仕組み

GitHubの「Resolve conversation」機能で解決済みにされたスレッドのみが除外されます。

コメント内のキーワード（`fixed`、`done` など）は判定に使われません。解決したスレッドは必ずGitHub上でResolveボタンを押してください。

## 設定ファイル

CLIオプションのデフォルト値を設定ファイルで定義できます。

読み込み順（後のものが優先）：

1. `~/.config/gh/pr-inbox.yml`（グローバル設定）
2. `.github/pr-inbox.yml`（リポジトリ設定）

設定例：

```yaml
defaults:
  format: md
  include_diff: true
  all_comments: true
  no_update_check: true

prompt: |
  # PRレビュー対応依頼

  以下の未解決コメントに対応してください。

  {{THREADS_MD}}

prompt_file: ~/.config/gh/pr-inbox-prompt.txt
```

`.github/pr-inbox.yml` をリポジトリに置いておけば、チーム内でデフォルト設定を共有できます。

## オプション一覧

| オプション | 説明 | デフォルト |
|-----------|------|-----------|
| `--pr`, `-p` | PR番号を指定 | 現在のブランチのPR |
| `--repo`, `-R` | リポジトリを指定 | 現在のリポジトリ |
| `--format`, `-f` | 出力形式（md/json） | md |
| `--all` | 解決済みも含める | false |
| `--p0` | P0のみ表示 | false |
| `--budget` | 表示するスレッド数の上限（0 = 無制限） | 0 |
| `--include-diff` | 差分を含める | false |
| `--include-times` | 日時を含める | false |
| `--all-comments` | 全コメントを含める | false |
| `--include-issue-comments` | PR会話を含める | false |
| `--no-update-check` | 更新チェックを無効化 | false |
| `--prompt-file` | プロンプトファイルを指定 | 設定ファイルの値 |
| `--prompt` | インラインでプロンプトを指定 | - |

## 注意点

- GitHub CLI (`gh`) のインストールと認証が必要です
- 解決判定はGitHubのResolve conversation機能のみを使用しています（コメント内キーワードは見ません）
- 初回実行時にアップデートチェックが走ります（CIなどでは `--no-update-check` 推奨）
- 大量のコメントがあるPRでは、GitHub API のRate Limitに注意してください

## まとめ

`gh-pr-inbox` は、PRのレビューコメントをLLMに渡しやすい形式に整形するツールです。

- 未解決のみ抽出、優先度付け（P0/P1/P2）
- Markdown/JSON出力でLLM連携しやすい
- プロンプトテンプレートで出力をカスタマイズ可能

AIエージェントにPR修正を任せる際の前処理として活用してください。
